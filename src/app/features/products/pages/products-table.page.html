<div class="products-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Catálogo de Productos</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <!-- Barra de búsqueda -->
      <div class="search-container">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Buscar productos</mat-label>
          <input
            matInput
            placeholder="Escribe para buscar..."
            (input)="onSearchChange($event)"
            [value]="searchQuery()"
          />
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
      </div>

      <!-- Indicador de carga -->
      <div *ngIf="loading()" class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Cargando productos...</p>
      </div>

      <!-- Mensaje de error -->
      <div *ngIf="error()" class="error-container">
        <mat-icon color="warn">error</mat-icon>
        <p>{{ error() }}</p>
        <button mat-raised-button color="primary" (click)="loadProducts()">
          <mat-icon>refresh</mat-icon>
          Reintentar
        </button>
      </div>

      <!-- Tabla de productos -->
      <div *ngIf="!loading() && !error()" class="table-container">
        <table mat-table [dataSource]="dataSource" class="products-table">
          <!-- Columna ID -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef>ID</th>
            <td mat-cell *matCellDef="let product">{{ product.id }}</td>
          </ng-container>

          <!-- Columna Nombre -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Nombre</th>
            <td mat-cell *matCellDef="let product" class="name-cell">
              <div class="product-info">
                <img
                  [src]="product.thumbnailUrl"
                  [alt]="product.name"
                  class="product-thumbnail"
                />
                <span>{{ product.name }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Columna Categoría -->
          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef>Categoría</th>
            <td mat-cell *matCellDef="let product">
              <span class="category-badge">{{ product.category }}</span>
            </td>
          </ng-container>

          <!-- Columna Precio -->
          <ng-container matColumnDef="price">
            <th mat-header-cell *matHeaderCellDef>Precio</th>
            <td mat-cell *matCellDef="let product" class="price-cell">
              {{ product.price | currency:'EUR':'symbol':'1.2-2' }}
            </td>
          </ng-container>

          <!-- Columna Rating -->
          <ng-container matColumnDef="rating">
            <th mat-header-cell *matHeaderCellDef>Rating</th>
            <td mat-cell *matCellDef="let product" class="rating-cell">
              <div class="rating-display">
                <mat-icon
                  *ngFor="let star of [1,2,3,4,5]"
                  [class.filled]="star <= product.rating"
                  class="star-icon"
                  >star</mat-icon
                >
                <span class="rating-value"
                  >{{ product.rating | number:'1.1-1' }}</span
                >
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns;"
            (click)="onRowClick(row)"
            class="product-row"
          ></tr>
        </table>

        <!-- Paginación -->
        <mat-paginator
          [length]="totalItems()"
          [pageSize]="pageSize"
          [pageIndex]="currentPage - 1"
          [pageSizeOptions]="pageSizeOptions"
          (page)="onPageChange($event)"
          showFirstLastButtons
          hidePageSize="false"
        >
        </mat-paginator>
      </div>
    </mat-card-content>
  </mat-card>
</div>
