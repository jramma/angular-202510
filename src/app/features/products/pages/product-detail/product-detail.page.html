<div class="detail-container">
  <!-- Indicador de carga -->
  <div *ngIf="loading()" class="loading-container" role="status" aria-live="polite">
    <mat-spinner diameter="60" aria-label="Cargando producto"></mat-spinner>
    <p>Cargando producto...</p>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="error()" class="error-container" role="alert" aria-live="assertive">
    <mat-icon color="warn" class="error-icon" aria-hidden="true">error</mat-icon>
    <h2>Error al cargar el producto</h2>
    <p>{{ error() }}</p>
    <div class="error-actions">
      <button mat-raised-button color="primary" (click)="onRetry()"
              [disabled]="loading()"
              aria-label="Reintentar carga del producto">
        <mat-icon aria-hidden="true" [class.spinning]="loading()">refresh</mat-icon>
        {{ loading() ? 'Reintentando...' : 'Reintentar' }}
      </button>
      <button mat-stroked-button color="primary" routerLink="/products"
              aria-label="Volver al catálogo">
        <mat-icon aria-hidden="true">arrow_back</mat-icon>
        Volver al catálogo
      </button>
    </div>
  </div>

  <!-- Detalle del producto -->
  <mat-card *ngIf="!loading() && !error() && product()" class="product-detail-card">
    <mat-card-header>
      <h1 #titleEl tabindex="-1" class="product-title">{{ product()?.name }}</h1>
    </mat-card-header>

    <mat-card-content>
      <div class="product-content">
        <!-- Imagen del producto -->
        <div class="product-image-container">
          <img
            [src]="product()?.thumbnailUrl"
            [alt]="'Imagen del producto ' + (product()?.name || '')"
            class="product-image"
            loading="lazy"
            (error)="onImageError($event)">
        </div>

        <!-- Información del producto -->
        <div class="product-info">
          <div class="product-meta">
            <mat-chip-set>
              <mat-chip>{{ product()?.category }}</mat-chip>
            </mat-chip-set>

            <div class="rating-section" role="img" [attr.aria-label]="'Calificación: ' + (product()?.rating | number:'1.1-1') + ' de 5 estrellas'">
              <div class="rating-stars">
                <mat-icon *ngFor="let star of [1,2,3,4,5]"
                          [class.filled]="star <= (product()?.rating || 0)"
                          class="star-icon"
                          aria-hidden="true">star</mat-icon>
              </div>
              <span class="rating-value"
                    aria-label="Calificación del producto"
                    matTooltip="Calificación basada en opiniones de usuarios">{{ product()?.rating | number:'1.1-1' }}/5</span>
            </div>
          </div>

          <mat-divider></mat-divider>

          <div class="price-section">
            <span class="price-label">Precio:</span>
            <span class="price-value"
                  [attr.aria-label]="'Precio: ' + (product()?.price | priceFormat:'EUR')"
                  matTooltip="Precio final incluyendo impuestos">{{ product()?.price | priceFormat:'EUR' }}</span>
          </div>

          <mat-divider></mat-divider>

          <div class="description-section">
            <h3>Descripción</h3>
            <p class="product-description">{{ product()?.description }}</p>
          </div>
        </div>
      </div>
    </mat-card-content>

    <mat-card-actions>
      <button mat-raised-button color="primary" routerLink="/products" aria-label="Volver al catálogo de productos">
        <mat-icon aria-hidden="true">arrow_back</mat-icon>
        Volver al catálogo
      </button>
    </mat-card-actions>
  </mat-card>
</div>
